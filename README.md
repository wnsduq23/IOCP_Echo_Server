# IOCP Echo Server

## π“ λ©μ°¨
- [κ°μ”](#κ°μ”)
- [ν”„λ΅μ νΈ μ„¤λ…](#ν”„λ΅μ νΈ-μ„¤λ…)
- [μ£Όμ” κΈ°λ¥ μ„¤λ…](#μ£Όμ”κΈ°λ¥_μ„¤λ…)
- [ν…μ¤νΈ](#ν…μ¤νΈ)
- [ν΄λ” κµ¬μ΅°](#ν΄λ”-κµ¬μ΅°)

---

## κ°μ”

- **ν”„λ΅μ νΈ μ΄λ¦„**: IOCP Echo Server
- **κ°λ° κΈ°κ°„**: 2025.02 ~ 2025.03
- **κ°λ° μ–Έμ–΄**: C++
- **κ°λ° μΈμ›**: 1λ…

---

## ν”„λ΅μ νΈ μ„¤λ…

IOCP κΈ°λ°μ Echo μ„λ²„μ…λ‹λ‹¤.

`CLanServer` μ¶”μƒ ν΄λμ¤λ¥Ό μƒμ†λ°›μ•„ `CEchoServer`λ¥Ό κµ¬ν„ν•μ€μµλ‹λ‹¤.

μ„λ²„λ” `Start()` νΈμ¶ μ‹ Winsock μ΄κΈ°ν™”μ™€ listen μ†μΌ“ μ„¤μ •μ„ μν–‰ν•©λ‹λ‹¤.

`AcceptThread`, `WorkerThread`, `ReleaseThread`λ¥Ό μƒμ„±ν•μ—¬  
ν΄λΌμ΄μ–ΈνΈ μλ½, λ„¤νΈμ›ν¬ I/O μ²λ¦¬, μ„Έμ… ν•΄μ λ¥Ό κ°κ° λ‹΄λ‹Ήν•©λ‹λ‹¤.

λ©”μ‹μ§€ μμ‹  μ‹ `SerializePacket`μ„ νμ‹±ν•μ—¬  
λ™μΌν• λ°μ΄ν„°λ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ λ‹¤μ‹ μ „μ†΅ν•λ” μ—μ½” λ΅μ§μ„ `OnMessage()`μ—μ„ μν–‰ν•©λ‹λ‹¤.

---

## ν…μ¤νΈ

### μ©μ–΄ μ„¤λ…
- **OverSend**: IOCP μ›μ»¤ μ¤λ λ“κ°€ Send μ™„λ£ ν†µμ§€λ¥Ό λ°›κΈ° μ „μ—λ„ λ™μ‹μ— λ°μ†΅ν•  μ μλ” WSASend μ”μ²­μ μµλ€ κ°μ(μλ„μ° ν¬κΈ°).  
- **Disconnect Delay**: λ”λ―Έ ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ λμ€ ν›„ μ¬μ—°κ²°μ„ μ‹λ„ν•κΈ° μ „κΉμ§€ λ€κΈ°ν•λ” μ‹κ°„(ms).  
- **Loop Delay**: μ „μ²΄ μ—μ½” λ£¨ν”„(ν΄λΌμ΄μ–ΈνΈλ³„ Echo μ”μ²­ κ²€μ‚¬ λ° Send νΈμ¶) μ‚¬μ΄μ λ€κΈ° μ‹κ°„(ms).

#### μ‹¤ν–‰ν™”λ©΄ μ£Όμ” ν•­λ©
- `Error β€“ Connect Fail`: ν΄λΌμ΄μ–ΈνΈ `connect()` μ‹¤ν¨ νμ  
- `Error β€“ Disconnect from Server`: μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈ μ—°κ²°μ„ μΌλ°©μ μΌλ΅ λμ€ νμ  
  (μ •μƒ: `AcceptTotal` == λ”λ―Έμ `ConnectTotal`)  
- `Error β€“ LoginPacket β€¦`: λ¬΄μ‹  
- `Error β€“ Echo Not Recv`: 500ms μ΄μƒ μ‘λ‹µ μ—†λ” κ²½μ° (ν…μ¤νΈ μ¤‘ μ λ€ λ„μ λμ§€ μ•μ•„μ•Ό ν•¨)  
- `Error β€“ Packet Error`: μ „μ†΅Β·μμ‹  κ°’ λ¶μΌμΉ (μ λ€ λ°μƒν•λ©΄ μ• λ¨)  

> `*` ν‘μ‹λ μ—λ¬ ν•­λ©μ€ ν…μ¤νΈ μ¤‘ λ°μƒν•΄μ„λ” μ• λ©λ‹λ‹¤.

### μ¶”κ°€ μ¤νΈλ μ¤ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤
1. **μ—°κ²°/ν•΄μ  λ°λ³µ**  
   - μ„¤μ •λ `Client Count` λ§νΌ μ ‘μ† β†’ `Disconnect Test=Yes` μƒνƒμ—μ„ λλ¤ν•κ² μ„λ²„ μ—°κ²° ν•΄μ  λ° μ¬μ ‘μ†
     

2. **λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦**  
   - κ° ν΄λΌμ΄μ–ΈνΈ μ„Έμ…λ§λ‹¤ 8λ°”μ΄νΈ κ³ μ  μ¦κ°€ κ°’ μ „μ†΅  
   - μ„λ²„λ΅λ¶€ν„° λ°›μ€ κ°’μ„ μμ‹ μ΄ λ³΄λ‚Έ κ°’κ³Ό **1:1 μΌμΉ**ν•λ”μ§€ λΉ„κµ  
3. **Overlapped I/O μ •ν™•μ„±**  
   - `Wait Echo Count` (λλ” λ‚΄λ¶€ `m_IOCount`)κ°€ I/O μ”μ²­ μ „ν›„λ΅ μ •ν™•ν μ¦κ°€Β·κ°μ†ν•μ—¬  
     Overlapped I/O μΆ…λ£ μ μ°¨κ°€ μ¬λ°”λ¥΄κ² μ²λ¦¬λλ”μ§€ ν™•μΈ  
4. **κ²€μ¦ ν•­λ©**  
   - μ„λ²„μ **μ ‘μ† κ±°λ¶€**(reject) λ°μƒ μ—¬λ¶€  
   - μ„λ²„μ—μ„ **κ°•μ  μ—°κ²° ν•΄μ ** λ°μƒ μ—¬λ¶€  
   - μ „μ†΅ κ°’κ³Ό μμ‹  κ°’μ **μΌμΉ** μ—¬λ¶€  


---

## ν΄λ” κµ¬μ΅°
<PRE>
π“¦ IOCP-Echo-Server (ver2)
β”£ π“‚Core               # κ³µν†µ ν—¤λ” λ° μ ν‹Έ
β”ƒ β”£ π“ pch.h
β”ƒ β”£ π“ Define.h
β”ƒ β”£ π“ RingBuffer.h
β”ƒ β”— π“ SerializePacket.h
β”£ π“‚Network            # IOCP κΈ°λ° λ„¤νΈμ›ν¬ μ„λ²„
β”ƒ β”£ π“ CLanServer.h
β”ƒ β”£ π“ CLanServer.cpp
β”ƒ β”£ π“ CEchoServer.h
β”ƒ β”— π“ CEchoServer.cpp
β”£ π“‚Session            # μ„Έμ… κ΄€λ¦¬
β”ƒ β”— π“ Session.h
β”£ π“‚Main               # μ§„μ…μ 
β”ƒ β”£ π“ Main.h
β”ƒ β”— π“ Main.cpp
β”— π“‚Utils              # λ΅κΉ… λ“± κ³µν†µ λ¨λ“
  β”£ π“ SystemLog.h
  β”— π“ SystemLog.cpp
</PRE>
